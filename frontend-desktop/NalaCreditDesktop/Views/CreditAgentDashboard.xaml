<Window x:Class="NalaCreditDesktop.Views.CreditAgentDashboard"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Nala Kredi Ti Machann - Agent de CrÃ©dit"
        Height="720" Width="1280"
        WindowStartupLocation="CenterScreen"
        Background="#F7F9FB">
    <Window.Resources>
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.2" Color="#1E1E1E"/>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="MenuButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Left"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#0D6EFD"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#0D6EFD"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="14,10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#0B5ED7"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#0F3D91" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal" Grid.Column="0">
                    <TextBlock Text="ðŸ§­" FontSize="28" VerticalAlignment="Center" Margin="0,0,12,0"/>
                    <StackPanel>
                        <TextBlock Text="Tableau de bord Agent de CrÃ©dit" FontSize="20" FontWeight="Bold" Foreground="White"/>
                        <TextBlock x:Name="BranchNameText" Text="Succursale" Foreground="#E6ECFF"/>
                    </StackPanel>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock x:Name="TimeText" Foreground="White" FontSize="16"/>
                    <TextBlock x:Name="DateText" Foreground="#E6ECFF" FontSize="16" Margin="12,0,0,0"/>
                    <TextBlock x:Name="ConnectionStatusText" Foreground="#E6ECFF" FontSize="14" Margin="12,0,0,0"/>
                    <TextBlock x:Name="LastRefreshText" Foreground="#E6ECFF" FontSize="14" Margin="12,0,0,0"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Grid.Column="2">
                    <Button x:Name="RefreshButton" Content="âŸ³ RafraÃ®chir" Style="{StaticResource PrimaryButton}" Click="Refresh_Click"/>
                    <Button x:Name="LogoutButton" Content="DÃ©connexion" Style="{StaticResource PrimaryButton}" Background="#DC3545" Click="Logout_Click" Margin="8,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Body -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Sidebar -->
            <Border Grid.Column="0" Background="#102542">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="0,12">
                        <TextBlock Text="Navigation" Margin="16,0" Foreground="#9CB3D8" FontWeight="Bold"/>
                        <Button x:Name="DashboardButton" Content="ðŸ  Tableau de bord" Style="{StaticResource MenuButton}" Click="Dashboard_Click"/>
                        <Button x:Name="NewApplicationButton" Content="âž• Nouvelle demande" Style="{StaticResource MenuButton}" Click="NewApplication_Click"/>
                        <Button x:Name="MyApplicationsButton" Content="ðŸ“„ Mes demandes" Style="{StaticResource MenuButton}" Click="MyApplications_Click"/>
                        <Button x:Name="PendingReviewButton" Content="â³ En attente" Style="{StaticResource MenuButton}" Click="PendingReview_Click"/>
                        <Button x:Name="ActiveLoansButton" Content="ðŸ’¼ CrÃ©dits actifs" Style="{StaticResource MenuButton}" Click="ActiveLoans_Click"/>
                        <Button x:Name="OverdueLoansButton" Content="âš ï¸ Retards" Style="{StaticResource MenuButton}" Click="OverdueLoans_Click"/>
                        <Button x:Name="PaymentsButton" Content="ðŸ’µ Paiements" Style="{StaticResource MenuButton}" Click="Payments_Click"/>
                        <Button x:Name="BorrowersButton" Content="ðŸ‘¥ Emprunteurs" Style="{StaticResource MenuButton}" Click="Borrowers_Click"/>
                        <Button x:Name="SearchBorrowerButton" Content="ðŸ” Rechercher client" Style="{StaticResource MenuButton}" Click="SearchBorrower_Click"/>
                        <Button x:Name="MyPerformanceButton" Content="ðŸ“ˆ Performance" Style="{StaticResource MenuButton}" Click="MyPerformance_Click"/>
                        <Button x:Name="PortfolioReportButton" Content="ðŸ“Š Rapport" Style="{StaticResource MenuButton}" Click="PortfolioReport_Click"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Main content -->
            <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="12">
                    <!-- Hero -->
                    <Border Style="{StaticResource Card}" Background="#0D6EFD">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="Bon travail !" Foreground="#E6ECFF" FontSize="14"/>
                                <TextBlock x:Name="OfficerNameText" Text="Agent" Foreground="White" FontSize="24" FontWeight="Bold"/>
                                <TextBlock Text="Suivez tous les crÃ©dits de votre succursale" Foreground="#E6ECFF"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button x:Name="QuickNewApplicationButton" Content="Nouveau crÃ©dit" Style="{StaticResource PrimaryButton}" Click="NewApplication_Click"/>
                                <Button x:Name="QuickRecordPaymentButton" Content="Enregistrer paiement" Style="{StaticResource PrimaryButton}" Click="RecordPayment_Click" Background="#198754" Margin="8,0,0,0"/>
                                <Button x:Name="QuickSearchButton" Content="Rechercher client" Style="{StaticResource PrimaryButton}" Click="SearchBorrower_Click" Background="#6C757D" Margin="8,0,0,0"/>
                                <Button x:Name="QuickReportButton" Content="Rapport rapide" Style="{StaticResource PrimaryButton}" Click="MyPerformance_Click" Background="#6C757D" Margin="8,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- KPI row -->
                    <Grid Margin="0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource Card}" Grid.Column="0">
                            <StackPanel>
                                <TextBlock Text="Demandes en attente" Foreground="#6C757D" FontWeight="SemiBold"/>
                                <TextBlock x:Name="PendingApplicationsText" FontSize="28" FontWeight="Bold"/>
                                <TextBlock Text="Demandes" Foreground="#6C757D"/>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource Card}" Grid.Column="1">
                            <StackPanel>
                                <TextBlock Text="CrÃ©dits actifs" Foreground="#6C757D" FontWeight="SemiBold"/>
                                <TextBlock x:Name="ActiveLoansText" FontSize="28" FontWeight="Bold"/>
                                <TextBlock Text="Dossiers" Foreground="#6C757D"/>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource Card}" Grid.Column="2">
                            <StackPanel>
                                <TextBlock Text="Retards" Foreground="#6C757D" FontWeight="SemiBold"/>
                                <TextBlock x:Name="OverdueLoansText" FontSize="28" FontWeight="Bold" Foreground="#DC3545"/>
                                <TextBlock Text="CrÃ©dits Ã  suivre" Foreground="#6C757D"/>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource Card}" Grid.Column="3">
                            <StackPanel>
                                <TextBlock Text="Taux remboursement" Foreground="#6C757D" FontWeight="SemiBold"/>
                                <TextBlock x:Name="RepaymentRateText" FontSize="28" FontWeight="Bold"/>
                                <TextBlock Text="%" Foreground="#6C757D"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Portfolio row -->
                    <Grid Margin="0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource Card}" Grid.Column="0">
                            <StackPanel Orientation="Horizontal">
                                <StackPanel>
                                    <TextBlock Text="Portefeuille actif" Foreground="#6C757D" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="PortfolioAmountText" FontSize="28" FontWeight="Bold"/>
                                    <TextBlock Text="Montant total" Foreground="#6C757D"/>
                                </StackPanel>
                                <StackPanel Margin="20,0,0,0">
                                    <TextBlock Text="Paiements cette semaine" Foreground="#6C757D" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="PaymentsThisWeekTotalText" FontSize="24" FontWeight="Bold"/>
                                    <TextBlock Text="HTG" Foreground="#6C757D"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource Card}" Grid.Column="1">
                            <StackPanel>
                                <TextBlock Text="ApprouvÃ©s ce mois" Foreground="#6C757D" FontWeight="SemiBold"/>
                                <TextBlock x:Name="ApprovedThisMonthText" FontSize="26" FontWeight="Bold"/>
                                <TextBlock Text="Dossiers" Foreground="#6C757D"/>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource Card}" Grid.Column="2">
                            <StackPanel>
                                <TextBlock Text="Taux d'approbation" Foreground="#6C757D" FontWeight="SemiBold"/>
                                <TextBlock x:Name="ApprovalRateText" FontSize="26" FontWeight="Bold"/>
                                <TextBlock Text="%" Foreground="#6C757D"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Lists -->
                    <Grid Margin="0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource Card}" Grid.Column="0">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Ã‰chÃ©ances cette semaine" FontSize="16" FontWeight="Bold"/>
                                    <Border Grid.Column="1" Background="#0D6EFD" CornerRadius="12" Padding="8,2">
                                        <TextBlock x:Name="PendingCountBadge" Text="0" Foreground="White"/>
                                    </Border>
                                </Grid>
                                <DataGrid x:Name="UpcomingPaymentsDataGrid" AutoGenerateColumns="False" HeadersVisibility="Column" Margin="0,8,0,0" CanUserAddRows="False" IsReadOnly="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Client" Binding="{Binding BorrowerName}" Width="*"/>
                                        <DataGridTextColumn Header="PrÃªt" Binding="{Binding LoanNumber}" Width="120"/>
                                        <DataGridTextColumn Header="Ã‰chÃ©ance" Binding="{Binding DueDate, StringFormat=dd/MM/yyyy}" Width="120"/>
                                        <DataGridTextColumn Header="Montant" Binding="{Binding Amount, StringFormat=N0}" Width="120"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource Card}" Grid.Column="1">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="CrÃ©dits en retard" FontSize="16" FontWeight="Bold"/>
                                    <Border Grid.Column="1" Background="#DC3545" CornerRadius="12" Padding="8,2">
                                        <TextBlock x:Name="OverdueCountBadge" Text="0" Foreground="White"/>
                                    </Border>
                                </Grid>
                                <DataGrid x:Name="OverdueLoansDataGrid" AutoGenerateColumns="False" HeadersVisibility="Column" Margin="0,8,0,0" CanUserAddRows="False" IsReadOnly="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="PrÃªt" Binding="{Binding LoanNumber}" Width="120"/>
                                        <DataGridTextColumn Header="Client" Binding="{Binding BorrowerName}" Width="*"/>
                                        <DataGridTextColumn Header="Retard (j)" Binding="{Binding DaysOverdue}" Width="90"/>
                                        <DataGridTextColumn Header="Montant dÃ»" Binding="{Binding OutstandingAmount, StringFormat=N0}" Width="120"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Branch loans table -->
                    <Border Style="{StaticResource Card}">
                        <StackPanel>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Tous les crÃ©dits de la succursale" FontSize="16" FontWeight="Bold"/>
                                <Button Grid.Column="1" x:Name="ViewAllApplicationsButton" Content="Voir tout" Style="{StaticResource PrimaryButton}" Click="MyApplications_Click" Background="#6C757D"/>
                            </Grid>
                            <DataGrid x:Name="BranchLoansDataGrid" AutoGenerateColumns="False" HeadersVisibility="Column" CanUserAddRows="False" IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="PrÃªt" Binding="{Binding LoanNumber}" Width="120"/>
                                    <DataGridTextColumn Header="Client" Binding="{Binding Borrower}" Width="*"/>
                                    <DataGridTextColumn Header="Montant" Binding="{Binding ApprovedAmount, StringFormat=N0}" Width="120"/>
                                    <DataGridTextColumn Header="Reste" Binding="{Binding OutstandingBalance, StringFormat=N0}" Width="120"/>
                                    <DataGridTextColumn Header="Statut" Binding="{Binding Status}" Width="140"/>
                                    <DataGridTextColumn Header="Agent" Binding="{Binding LoanOfficer}" Width="150"/>
                                    <DataGridTextColumn Header="Prochain paiement" Binding="{Binding NextPaymentDate, StringFormat=dd/MM/yyyy}" Width="140"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </Border>

                    <!-- Activity / applications -->
                    <Grid Margin="0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource Card}" Grid.Column="0">
                            <StackPanel>
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="DerniÃ¨res demandes" FontWeight="Bold" FontSize="16"/>
                                    <Button Grid.Column="1" x:Name="ViewOverdueLoansButton" Content="Mettre Ã  jour" Style="{StaticResource PrimaryButton}" Click="OverdueLoans_Click" Background="#6C757D"/>
                                </Grid>
                                <DataGrid x:Name="RecentApplicationsDataGrid" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Demande" Binding="{Binding ApplicationNumber}" Width="140"/>
                                        <DataGridTextColumn Header="Client" Binding="{Binding BorrowerName}" Width="*"/>
                                        <DataGridTextColumn Header="Montant" Binding="{Binding Amount, StringFormat=N0}" Width="120"/>
                                        <DataGridTextColumn Header="Statut" Binding="{Binding Status}" Width="120"/>
                                        <DataGridTextColumn Header="CrÃ©Ã©e" Binding="{Binding CreatedAt, StringFormat=dd/MM/yyyy}" Width="120"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource Card}" Grid.Column="1">
                            <StackPanel>
                                <TextBlock Text="ActivitÃ©s rÃ©centes" FontWeight="Bold" FontSize="16"/>
                                <ListView x:Name="RecentActivitiesListView" Margin="0,8,0,0">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock Text="{Binding Description}" FontWeight="SemiBold"/>
                                                <TextBlock Text="{Binding Timestamp, StringFormat=dd/MM/yyyy HH:mm}" Foreground="#6C757D" FontSize="12"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackPanel>
                        </Border>
                    </Grid>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Grid>
</Window>
