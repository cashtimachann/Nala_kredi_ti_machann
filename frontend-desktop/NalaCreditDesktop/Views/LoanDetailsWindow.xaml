<Window x:Class="NalaCreditDesktop.Views.LoanDetailsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="DÃ©tails du CrÃ©dit" Height="800" Width="1100"
        WindowStartupLocation="CenterOwner" Background="#F7F9FB"
        Loaded="Window_Loaded">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Background="#0F3D91" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <TextBlock x:Name="TitleText" Text="DÃ©tails du CrÃ©dit" 
                             Foreground="White" FontSize="20" FontWeight="Bold"/>
                    <TextBlock x:Name="LoanNumberText" Foreground="#E6ECFF" FontSize="14" Margin="0,4,0,0"/>
                </StackPanel>
                <Button x:Name="CloseButton" Grid.Column="1" Content="âœ• Fermer" 
                       Background="#DC3545" Foreground="White" Padding="12,6"
                       Click="CloseButton_Click"/>
            </Grid>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="16">
                <!-- Loading Indicator -->
                <TextBlock x:Name="LoadingText" Text="Chargement des dÃ©tails..." 
                         FontSize="14" Foreground="#666" HorizontalAlignment="Center" 
                         Margin="0,20" Visibility="Visible"/>

                <!-- Main Content (Hidden during loading) -->
                <StackPanel x:Name="ContentPanel" Visibility="Collapsed">
                    
                    <!-- Summary Cards Row -->
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Principal -->
                        <Border Grid.Column="0" Background="White" CornerRadius="8" Padding="16" Margin="0,0,8,0" 
                               BorderBrush="#E0E0E0" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="ðŸ’° Montant Principal" FontSize="12" Foreground="#666"/>
                                <TextBlock x:Name="PrincipalText" FontSize="20" FontWeight="Bold" 
                                         Foreground="#0F3D91" Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Total Paid -->
                        <Border Grid.Column="1" Background="White" CornerRadius="8" Padding="16" Margin="0,0,8,0"
                               BorderBrush="#E0E0E0" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="âœ“ Total PayÃ©" FontSize="12" Foreground="#666"/>
                                <TextBlock x:Name="TotalPaidText" FontSize="20" FontWeight="Bold" 
                                         Foreground="#28A745" Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Remaining Balance -->
                        <Border Grid.Column="2" Background="White" CornerRadius="8" Padding="16" Margin="0,0,8,0"
                               BorderBrush="#E0E0E0" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="â³ Solde Restant" FontSize="12" Foreground="#666"/>
                                <TextBlock x:Name="RemainingText" FontSize="20" FontWeight="Bold" 
                                         Foreground="#FD7E14" Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Next Payment -->
                        <Border Grid.Column="3" Background="White" CornerRadius="8" Padding="16"
                               BorderBrush="#E0E0E0" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="ðŸ“… Prochain Paiement" FontSize="12" Foreground="#666"/>
                                <TextBlock x:Name="NextPaymentText" FontSize="16" FontWeight="Bold" 
                                         Foreground="#0F3D91" Margin="0,8,0,0" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Borrower Information -->
                    <Border Background="White" CornerRadius="8" Padding="16" Margin="0,0,0,16"
                           BorderBrush="#E0E0E0" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="ðŸ‘¤ Informations sur l'Emprunteur" FontSize="16" FontWeight="Bold" 
                                     Foreground="#0F3D91" Margin="0,0,0,12"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Nom Complet:" FontWeight="SemiBold" Margin="0,0,12,8"/>
                                <TextBlock x:Name="BorrowerNameText" Grid.Row="0" Grid.Column="1" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="0" Grid.Column="2" Text="TÃ©lÃ©phone:" FontWeight="SemiBold" Margin="16,0,12,8"/>
                                <TextBlock x:Name="BorrowerPhoneText" Grid.Row="0" Grid.Column="3" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="NumÃ©ro Compte Ã‰pargne:" FontWeight="SemiBold" Margin="0,0,12,8"/>
                                <TextBlock x:Name="BorrowerAccountText" Grid.Row="1" Grid.Column="1" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="1" Grid.Column="2" Text="Email:" FontWeight="SemiBold" Margin="16,0,12,8"/>
                                <TextBlock x:Name="BorrowerEmailText" Grid.Row="1" Grid.Column="3" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Adresse:" FontWeight="SemiBold" Margin="0,0,12,8"/>
                                <TextBlock x:Name="BorrowerAddressText" Grid.Row="2" Grid.Column="1" Margin="0,0,0,8" TextWrapping="Wrap"/>

                                <TextBlock Grid.Row="2" Grid.Column="2" Text="Profession:" FontWeight="SemiBold" Margin="16,0,12,8"/>
                                <TextBlock x:Name="BorrowerOccupationText" Grid.Row="2" Grid.Column="3" Margin="0,0,0,8"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Loan Details -->
                    <Border Background="White" CornerRadius="8" Padding="16" Margin="0,0,0,16"
                           BorderBrush="#E0E0E0" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="ðŸ“‹ DÃ©tails du PrÃªt" FontSize="16" FontWeight="Bold" 
                                     Foreground="#0F3D91" Margin="0,0,0,12"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Type de CrÃ©dit:" FontWeight="SemiBold" Margin="0,0,12,8"/>
                                <TextBlock x:Name="LoanTypeText" Grid.Row="0" Grid.Column="1" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="0" Grid.Column="2" Text="Statut:" FontWeight="SemiBold" Margin="16,0,12,8"/>
                                <TextBlock x:Name="StatusText" Grid.Row="0" Grid.Column="3" Margin="0,0,0,8" FontWeight="Bold"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Taux d'IntÃ©rÃªt:" FontWeight="SemiBold" Margin="0,0,12,8"/>
                                <TextBlock x:Name="InterestRateText" Grid.Row="1" Grid.Column="1" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="1" Grid.Column="2" Text="DurÃ©e:" FontWeight="SemiBold" Margin="16,0,12,8"/>
                                <TextBlock x:Name="DurationText" Grid.Row="1" Grid.Column="3" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Date de DÃ©caissement:" FontWeight="SemiBold" Margin="0,0,12,8"/>
                                <TextBlock x:Name="DisbursementDateText" Grid.Row="2" Grid.Column="1" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="2" Grid.Column="2" Text="Date d'Ã‰chÃ©ance:" FontWeight="SemiBold" Margin="16,0,12,8"/>
                                <TextBlock x:Name="MaturityDateText" Grid.Row="2" Grid.Column="3" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Succursale:" FontWeight="SemiBold" Margin="0,0,12,8"/>
                                <TextBlock x:Name="BranchText" Grid.Row="3" Grid.Column="1" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="3" Grid.Column="2" Text="Agent de CrÃ©dit:" FontWeight="SemiBold" Margin="16,0,12,8"/>
                                <TextBlock x:Name="LoanOfficerText" Grid.Row="3" Grid.Column="3" Margin="0,0,0,8"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Paiement Mensuel:" FontWeight="SemiBold" Margin="0,0,12,8"/>
                                <TextBlock x:Name="MonthlyPaymentText" Grid.Row="4" Grid.Column="1" Margin="0,0,0,8" FontWeight="Bold" Foreground="#0F3D91"/>

                                <TextBlock Grid.Row="4" Grid.Column="2" Text="Jours de Retard:" FontWeight="SemiBold" Margin="16,0,12,8"/>
                                <TextBlock x:Name="DaysOverdueText" Grid.Row="4" Grid.Column="3" Margin="0,0,0,8"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Tabs -->
                    <TabControl x:Name="TabControl" Background="White" BorderBrush="#E0E0E0" BorderThickness="1">
                        <!-- Payment Schedule Tab -->
                        <TabItem Header="ðŸ“… Calendrier de Remboursement">
                            <Grid Margin="16">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <DataGrid x:Name="ScheduleDataGrid" Grid.Row="0" AutoGenerateColumns="False" 
                                        IsReadOnly="True" CanUserAddRows="False" CanUserDeleteRows="False"
                                        HeadersVisibility="Column" GridLinesVisibility="None"
                                        AlternatingRowBackground="#F8F9FA" RowHeight="36">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="NÂ°" Binding="{Binding InstallmentNumber}" Width="60"/>
                                        <DataGridTextColumn Header="Date d'Ã‰chÃ©ance" Binding="{Binding DueDate, StringFormat=dd/MM/yyyy}" Width="130"/>
                                        <DataGridTextColumn Header="Principal" Binding="{Binding PrincipalAmount, StringFormat=N2}" Width="*"/>
                                        <DataGridTextColumn Header="IntÃ©rÃªts" Binding="{Binding InterestAmount, StringFormat=N2}" Width="*"/>
                                        <DataGridTextColumn Header="Frais" Binding="{Binding FeePortion, StringFormat=N2}" Width="*"/>
                                        <DataGridTextColumn Header="Total" Binding="{Binding TotalAmountWithFee, StringFormat=N2}" Width="*"/>
                                        <DataGridTextColumn Header="Statut" Binding="{Binding Status}" Width="100"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                                
                                <TextBlock x:Name="NoScheduleText" Grid.Row="1" Text="Aucun calendrier de remboursement disponible" 
                                         Visibility="Collapsed" HorizontalAlignment="Center" Margin="0,20"
                                         Foreground="#666" FontSize="14"/>
                            </Grid>
                        </TabItem>

                        <!-- Payment History Tab -->
                        <TabItem Header="ðŸ’³ Historique des Paiements">
                            <Grid Margin="16">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <DataGrid x:Name="PaymentsDataGrid" Grid.Row="0" AutoGenerateColumns="False" 
                                        IsReadOnly="True" CanUserAddRows="False" CanUserDeleteRows="False"
                                        HeadersVisibility="Column" GridLinesVisibility="None"
                                        AlternatingRowBackground="#F8F9FA" RowHeight="36">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Date" Binding="{Binding PaymentDate, StringFormat=dd/MM/yyyy}" Width="110"/>
                                        <DataGridTextColumn Header="NÂ° ReÃ§u" Binding="{Binding ReceiptNumber}" Width="130"/>
                                        <DataGridTextColumn Header="Montant" Binding="{Binding Amount, StringFormat=N2}" Width="*"/>
                                        <DataGridTextColumn Header="Principal" Binding="{Binding PrincipalAmount, StringFormat=N2}" Width="*"/>
                                        <DataGridTextColumn Header="IntÃ©rÃªts" Binding="{Binding InterestAmount, StringFormat=N2}" Width="*"/>
                                        <DataGridTextColumn Header="PÃ©nalitÃ©s" Binding="{Binding PenaltyAmount, StringFormat=N2}" Width="*"/>
                                        <DataGridTextColumn Header="MÃ©thode" Binding="{Binding PaymentMethod}" Width="100"/>
                                        <DataGridTextColumn Header="TraitÃ© par" Binding="{Binding ProcessedByName}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                                
                                <TextBlock x:Name="NoPaymentsText" Grid.Row="1" Text="Aucun paiement enregistrÃ©" 
                                         Visibility="Collapsed" HorizontalAlignment="Center" Margin="0,20"
                                         Foreground="#666" FontSize="14"/>
                            </Grid>
                        </TabItem>
                    </TabControl>

                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
